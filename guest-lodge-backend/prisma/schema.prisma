generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Booking {
  id                    String   @id @default(cuid())
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  ourReservationCode    String   @unique
  pmsConfirmationCode   String?
  stripePaymentIntentId String?  @unique
  status                String   @default("confirmed")
  hotelId               String
  roomName              String
  checkinDate           DateTime
  checkoutDate          DateTime
  nights                Int
  guestFirstName        String
  guestLastName         String
  guestEmail            String
  guestPhone            String
  subtotal              Float
  taxesAndFees          Float
  grandTotal            Float
  bookingType           String   @default("standard")
  
  // Fields for "Pay Later" bookings with pre-auth hold
  amountPaidNow         Float?   @default(0)
  preAuthHoldAmount     Float?
  holdStatus            String?  // 'active', 'released', 'captured'
  holdReleasedAt        DateTime?
  holdCapturedAt        DateTime?
  noShowFeePaid         Boolean  @default(false)

  // Front desk CRM
  crmStage    String?  @default("new")
  callStatus  String?  @default("not-called")
  notes       String?
  callLog     String?  // stored as JSON string
}

model PaymentDeclinedLead {
  id               String   @id @default(cuid())
  createdAt        DateTime @default(now())
  hotelId          String
  guestFirstName   String
  guestLastName    String
  guestEmail       String
  guestPhone       String
  roomName         String
  checkinDate      String
  checkoutDate     String
  nights           Int
  grandTotal       Float
  errorCode        String?
  errorDeclineCode String?
  errorMessage     String?
  paymentMethod    String?  // 'card' | 'wallet'
  called           Boolean  @default(false)
  notes            String?
}

model PushSubscription {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
<<<<<<< HEAD
  endpoint  String   @unique
  p256dh    String
  auth      String
  source    String?  // 'funnel' | 'crm'
=======
  endpoint  String
  p256dh    String
  auth      String
  source    String   @default("crm")   // 'crm' | 'funnel' â€“ who gets which notifications
>>>>>>> c4526c9e603cbc5668943dba17729e0e73641695
}
